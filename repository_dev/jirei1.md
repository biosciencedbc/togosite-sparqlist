# 事例1

「ヒト遺伝子のうち、肺で発現が高く、細胞膜表面に局在し、立体構造が分かっているタンパク質で、対応する医薬品（＝タンパク質に作用する化合物）が開発されているものに対応するバリアントの一覧」

## 目的

- build
  - 以下のものをいずれかのIDをキーにしてjoinする
    - "肺で発現が高い" 遺伝子のリスト 
        - 条件式：tissue == 肺
        - ソート：expression value
        - Refex ROKU flag (not in RDF)
        - https://refex.dbcls.jp/genelist_dl.php?db=human&roku_valid=1&rk[32]=32&order_key=score
    - "細胞膜表面に局在する" タンパク質のリスト
        - グラフ: Uniprot 
        - 条件式：subcellular location == membrane
        - http://ep6.dbcls.jp/togoid/sparqlist/uniprot_subcellular_location
	- タンパク質の立体構造が分かっている
	    - グラフ: PDB
		- 条件式：入力された遺伝子に紐付くPDBエントリが存在する
    - 対応する医薬品が開発されている
        - グラフ: chembl
        - 条件式: 入力されたタンパク質に対応する化合物が存在する
    - バリアントのリストを取得
        - グラフ: togovar
        - 条件式: 上記の条件でjoinして遺伝にリンクされるバリアントを取得する
        - http://ep6.dbcls.jp/togoid/sparqlist/variant_type
- 足りないデータ
  - 「特定の臓器で発現量の高い遺伝子
      - Refex ROKU flag (not in RDF)


## Parameters

* `subcellular_location`
  * example: 162 (Membrane)
* `hgnc`
  * example: 10050,10065,10322,1034,10378,10379,10380,10436,10477,10603,10606,10810,10827,1084,10840,10852,1087,11179,11317,11359,11389,11448,11449,11450,11713,11741,1176,118,11831,1185,1192,12033,12367,12420,12441,12469,12572,1260,12613,1273,12771,12799,12830,12843,13180,13206,13236,13518,13586,13601,13734,1377,1378,13780,14027,14033,14034,14035,14036,14037,14042,14044,14045,14046,14047,14048,14049,14050,14051,14052,14053,14054,14055,14056,14077,14111,14169,14198,14247,14254,14275,14276,14277,14278,14279,14404,14410,14412,14476,14477,14478,14479,14480,14483,14484,14487,14488,14489,14490,14491,14492,14493,14495,14498,14499,14501,14502,14504,14508,14509,14510,14511,14512,14513,14514,14515,14516,14517,14559,14601,14880,14929,14933,1505,1510,15453,15476,15508,15547,15714,15716,15769,15822,15825,15880,15894,15910,15916,16001,16065,16102,16205,16239,16264,16287,16289,16352,16354,16369,16429,16468,16475,16526,16608,16618,16631,16632,16633,16634,16635,16636,16650,16651,16652,16653,16654,16655,16684,16685,16686,16716,16717,16732,16812,16831,16869,16897,16902,16915,17037,17061,17074,17084,17152,17184,17190,1722,17258,17330,17341,17345,17366,17759,17772,17865,17868,1787,17889,17911,17929,17947,18049,18063,18073,18119,18155,18344,18348,18355,18407,18431,18453,18485,18503,18559,18606,18799,18802,18803,18828,18860,18871,19261,19331,19691,19708,19857,19958,20270,20278,20286,20390,20495,20499,20668,2088,20886,2095,20989,20999,21020,21022,21034,21051,21055,21061,21062,21115,21176,21208,21237,21259,21269,21285,21365,21427,21463,21528,21642,21645,21792,21906,22198,22393,23041,23075,2323,23355,23408,2342,23489,23518,23537,23676,23794,24009,24010,24044,24114,24133,24157,24247,24258,24263,24265,24276,24291,24316,24415,24447,24475,24604,24639,24683,24717,24812,24887,24923,24944,25068,25155,25216,25221,25241,25284,25302,25410,25443,25481,25496,25532,25570,25576,25634,25656,25734,25822,2597,25994,2602,26055,26063,26070,26094,26101,26112,26120,26150,26202,26220,2624,26274,26398,26404,26505,26600,2673,26777,26784,26922,26937,26946,27015,27052,2716,27288,27302,27309,2734,27375,27396,27413,2744,2753,27578,27820,28052,28074,28086,28135,28184,28249,28346,28358,2858,2861,28660,28716,28727,28758,28777,28783,28785,28816,2888,28883,28905,28913,28969,29071,292,29233,29300,2939,29510,29548,29569,29570,29609,29622,29666,29682,29787,29788,29789,29876,29882,29947,29969,29984,29996,30012,30029,30031,30229,30255,30262,30365,30384,30395,30546,30553,30710,30779,3078,30908,30931,30932,30972,3149,315,31665,31802,32016,32017,32583,33113,33196,33435,3346,33495,33551,33879,33904,341,3432,34489,35428,3574,3642,3650,368,3700,3701,3720,37216,3724,37281,3951,40038,40045,408,4108,4162,4188,4195,4196,4208,4236,4313,4331,4341,44317,4456,451,4550,4556,4623,4638,473,4800,4801,4803,4812,4817,4844,4907,4908,493,4976,5008,5185,5229,5244,53111,5331,5359,53816,5383,5384,5385,5386,5411,587,6047,6201,6215,6367,6600,664,6872,6874,69,6943,7166,7179,7223,7234,7377,7434,7441,7469,7506,7527,7554,76,7610,7692,7694,7714,7715,779,7828,7869,7978,7980,8028,8053,8056,8086,8125,8127,8142,823,83,837,838,840,845,846,847,848,85,850,8605,8607,87,870,871,8725,8768,8769,877,8777,8849,8867,8868,890,8992,9039,9108,9153,9165,9179,9180,9200,9283,93,9305,9323,9354,9355,9380,9399,9688,9721,977,9772,9820,9829,993,994,9998
* `gene_flag`
  * example: 1

## `hgnc_list`
```javascript
({hgnc}) => {
  hgnc = hgnc.replace(/\s/g,"")
  if (hgnc) {
    let array = hgnc.split(",");
    return "hgnc:" + array.join(" hgnc:");
  }
  return false;
}
```

## Endpoint

https://integbio.jp/rdf/mirror/uniprot/sparql

## `type`
```sparql
PREFIX up: <http://purl.uniprot.org/core/>
PREFIX taxon: <http://purl.uniprot.org/taxonomy/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX db: <http://purl.uniprot.org/database/>
PREFIX locat: <http://purl.uniprot.org/locations/>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX hgnc: <http://purl.uniprot.org/hgnc/>
{{#if gene_flag}}
SELECT DISTINCT (REPLACE (STR (?hgnc_uri), hgnc:, "") AS ?hgnc)
{{else}}
SELECT DISTINCT ?uri (REPLACE (STR (?uri), locat:, "") AS ?id) ?label (COUNT (?uniprot) AS ?count)
{{/if}}
WHERE {
  ?uniprot a up:Protein ;
           up:organism taxon:9606 ;
           up:proteome ?proteome ;
           up:annotation [ a up:Subcellular_Location_Annotation ;
{{#if subcellular_location}}
                           up:locatedIn/up:cellularComponent locat:{{subcellular_location}} ] .
  ?uniprot rdfs:seeAlso ?hgnc_uri .
  ?hgnc_uri up:database db:HGNC .
{{else}}
                           up:locatedIn/up:cellularComponent ?uri ] .
  ?uri skos:prefLabel ?label .
{{/if}}
{{#if hgnc_list}}
  VALUES ?hgnc_filter { {{hgnc_list}} }
  ?uniprot rdfs:seeAlso ?hgnc_filter .
{{/if}}
{{#if gene_flag}}
  ?uniprot rdfs:seeAlso ?hgnc .
  ?hgnc up:database db:HGNC .
{{/if}}
  FILTER(REGEX(STR(?proteome), "UP000005640"))
}
ORDER BY DESC(?count)
```